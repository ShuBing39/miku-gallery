name: Daily Miku Crawler ğŸµ

# è®¾å®šè§¦å‘æ¡ä»¶
on:
  # 1. å®šæ—¶è§¦å‘ï¼šæ¯å¤©å›½é™…æ ‡å‡†æ—¶é—´ 00:00 (åŒ—äº¬/æ—¥æœ¬æ—¶é—´æ—©ä¸Š 08:00 æˆ– 09:00)
  schedule:
    - cron: '0 0 * * *'
  # 2. æ‰‹åŠ¨è§¦å‘ï¼šå…è®¸ä½ åœ¨ GitHub ç½‘é¡µä¸Šç‚¹æŒ‰é’®æ‰‹åŠ¨è¿è¡Œ
  workflow_dispatch:

jobs:
  crawl:
    runs-on: ubuntu-latest # ä½¿ç”¨ GitHub æä¾›çš„å…è´¹ Linux ç”µè„‘

    steps:
      # ç¬¬ä¸€æ­¥ï¼šæŠŠä»£ç ä¸‹è½½åˆ°æœºå™¨äººç”µè„‘ä¸Š
      - name: Checkout code
        uses: actions/checkout@v3

      # ç¬¬äºŒæ­¥ï¼šå®‰è£… Node.js ç¯å¢ƒ
      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'

      # ç¬¬ä¸‰æ­¥ï¼šå®‰è£…ä¾èµ– (axios, cheerio, supabase...)
      - name: Install dependencies
        run: npm install

      # ç¬¬å››æ­¥ï¼šè¿è¡Œçˆ¬è™«è„šæœ¬
      - name: Run Crawler
        # è¿™é‡Œçš„ env æ˜¯å…³é”®ï¼ŒæŠŠåˆšæ‰å­˜çš„ Secrets æ³¨å…¥ç»™è„šæœ¬
        env:
          SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
          SUPABASE_SERVICE_KEY: ${{ secrets.SUPABASE_SERVICE_KEY }}
        run: node scripts/souder.js